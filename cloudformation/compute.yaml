AWSTemplateFormatVersion: "2010-09-09"
Description: >
  Compute stack for aws-ecommerce-infrastructure.
  Creates Lambda functions for Products, Cart, Checkout, and Orders APIs
  with IAM roles, logging, and environment configuration.



Parameters:

  ProjectName:
    Type: String

  Environment:
    Type: String

  LambdaCodeBucket:
    Type: String

  LambdaCodeKey:
    Type: String



Conditions:

  IsProd: !Equals [!Ref Environment, prod]



Resources:

  # ----------------------
  # IAM Roles
  # ----------------------

  CartAddLambdaRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-cart-add-lambda-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: !Sub "${ProjectName}-${Environment}-cart-add-lambda-policy"
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Sid: DynamoDbProductsTableAccess
                Effect: Allow
                Action:
                  - dynamodb:GetItem
                Resource:
                  - Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
                  - !Sub  # Include Indexes
                    - "${TableArn}/index/*"
                    - TableArn:
                        Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  CartGetLambdaRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-cart-get-lambda-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: !Sub "${ProjectName}-${Environment}-cart-get-lambda-policy"
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Sid: DynamoDbCartsTableAccess
                Effect: Allow
                Action:
                  - dynamodb:GetItem
                Resource:
                  - Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
                  - !Sub  # Include Indexes
                    - "${TableArn}/index/*"
                    - TableArn:
                        Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment
  
  CartUpdateLambdaRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-cart-update-lambda-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: !Sub "${ProjectName}-${Environment}-cart-update-lambda-policy"
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Sid: DynamoDbCartsTableAccess
                Effect: Allow
                Action:
                  - dynamodb:GetItem
                Resource:
                  - Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
                  - !Sub  # Include Indexes
                    - "${TableArn}/index/*"
                    - TableArn:
                        Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  CartRemoveLambdaRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-cart-remove-lambda-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: !Sub "${ProjectName}-${Environment}-cart-remove-lambda-policy"
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Sid: DynamoDbCartsTableAccess
                Effect: Allow
                Action:
                  - dynamodb:GetItem
                Resource:
                  - Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
                  - !Sub  # Include Indexes
                    - "${TableArn}/index/*"
                    - TableArn:
                        Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  CartClearLambdaRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-cart-clear-lambda-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: !Sub "${ProjectName}-${Environment}-cart-clear-lambda-policy"
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Sid: DynamoDbCartsTableAccess
                Effect: Allow
                Action:
                  - dynamodb:GetItem
                Resource:
                  - Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
                  - !Sub  # Include Indexes
                    - "${TableArn}/index/*"
                    - TableArn:
                        Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  ProductsGetLambdaRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-products-get-lambda-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: !Sub "${ProjectName}-${Environment}-products-get-lambda-policy"
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Sid: DynamoDbCartsTableAccess
                Effect: Allow
                Action:
                  - dynamodb:GetItem
                Resource:
                  - Fn::ImportValue: !Sub "${ProjectName}-${Environment}-ProductsTableArn"
                  - !Sub  # Include Indexes
                    - "${TableArn}/index/*"
                    - TableArn:
                        Fn::ImportValue: !Sub "${ProjectName}-${Environment}-ProductsTableArn"
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  CheckoutLambdaRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-checkout-lambda-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: !Sub "${ProjectName}-${Environment}-checkout-lambda-policy"
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Sid: DynamoDbCartsTableAccess
                Effect: Allow
                Action:
                  - dynamodb:GetItem
                Resource:
                  - Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  ProfileGetLambdaRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-profile-get-lambda-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: !Sub "${ProjectName}-${Environment}-profile-get-lambda-policy"
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Sid: DynamoDbCartsTableAccess
                Effect: Allow
                Action:
                  - dynamodb:GetItem
                Resource:
                  - Fn::ImportValue: !Sub "${ProjectName}-${Environment}-CartsTableArn"
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  OrdersGetLambdaRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: !Sub "${ProjectName}-${Environment}-orders-get-lambda-role"
      AssumeRolePolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Policies:
        - PolicyName: !Sub "${ProjectName}-${Environment}-orders-get-lambda-policy"
          PolicyDocument:
            Version: "2012-10-17"
            Statement:
              - Sid: DynamoDbOrdersTableAccess
                Effect: Allow
                Action:
                  - dynamodb:GetItem
                Resource:
                  - Fn::ImportValue: !Sub "${ProjectName}-${Environment}-OrdersTableArn"
                  - !Sub  # Include Indexes
                    - "${TableArn}/index/*"
                    - TableArn:
                        Fn::ImportValue: !Sub "${ProjectName}-${Environment}-OrdersTableArn"
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  LambdaExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
            Action: sts:AssumeRole
      ManagedPolicyArns:
        - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Tags:
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment


  # ----------------------
  # Lambda Functions
  # ----------------------

  CartAddFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-cart-add-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt CartAddLambdaRole.Arn
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: !Sub "${LambdaCodeKey}/cart-add.zip"
      Environment:
        Variables:
          PRODUCTS_TABLE: !ImportValue
            Fn::Sub: "${ProjectName}-${Environment}-CartsTableArn"
          ENVIRONMENT: !Ref Environment
          LOG_LEVEL: !If [IsProd, INFO, DEBUG]
      Timeout: 30
      MemorySize: 256
      ReservedConcurrentExecutions: !If [IsProd, 100, 10]
      Architectures:
        - arm64  # Graviton2
      TracingConfig:
        Mode: Active
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-cart-add-function"
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  CartGetFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-cart-get-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt CartGetLambdaRole.Arn
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: !Sub "${LambdaCodeKey}/cart-get.zip"
      Environment:
        Variables:
          CARTS_TABLE: !ImportValue
            Fn::Sub: "${ProjectName}-${Environment}-CartsTableName"
          ENVIRONMENT: !Ref Environment
          LOG_LEVEL: !If [IsProd, INFO, DEBUG]
      Timeout: 30
      MemorySize: 256
      ReservedConcurrentExecutions: !If [IsProd, 100, 10]
      Architectures:
        - arm64  # Graviton2
      TracingConfig:
        Mode: Active
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-cart-get-function"
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment
  
  CartUpdateFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-cart-update-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt CartUpdateLambdaRole.Arn
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: !Sub "${LambdaCodeKey}/cart-update.zip"
      Environment:
        Variables:
          CARTS_TABLE: !ImportValue
            Fn::Sub: "${ProjectName}-${Environment}-CartsTableName"
          ENVIRONMENT: !Ref Environment
          LOG_LEVEL: !If [IsProd, INFO, DEBUG]
      Timeout: 30
      MemorySize: 256
      ReservedConcurrentExecutions: !If [IsProd, 100, 10]
      Architectures:
        - arm64  # Graviton2
      TracingConfig:
        Mode: Active
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-cart-update-function"
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  CartRemoveFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-cart-remove-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt CartRemoveLambdaRole.Arn
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: !Sub "${LambdaCodeKey}/cart-remove.zip"
      Environment:
        Variables:
          CARTS_TABLE: !ImportValue
            Fn::Sub: "${ProjectName}-${Environment}-CartsTableName"
          ENVIRONMENT: !Ref Environment
          LOG_LEVEL: !If [IsProd, INFO, DEBUG]
      Timeout: 30
      MemorySize: 256
      ReservedConcurrentExecutions: !If [IsProd, 100, 10]
      Architectures:
        - arm64  # Graviton2
      TracingConfig:
        Mode: Active
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-cart-remove-function"
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  CartClearFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-cart-clear-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt CartClearLambdaRole.Arn
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: !Sub "${LambdaCodeKey}/cart-clear.zip"
      Environment:
        Variables:
          CARTS_TABLE: !ImportValue
            Fn::Sub: "${ProjectName}-${Environment}-CartsTableName"
          ENVIRONMENT: !Ref Environment
          LOG_LEVEL: !If [IsProd, INFO, DEBUG]
      Timeout: 30
      MemorySize: 256
      ReservedConcurrentExecutions: !If [IsProd, 100, 10]
      Architectures:
        - arm64  # Graviton2
      TracingConfig:
        Mode: Active
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-cart-clear-function"
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  ProductsGetFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-products-get-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt ProductsGetLambdaRole.Arn
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: !Sub "${LambdaCodeKey}/products-get.zip"
      Environment:
        Variables:
          CARTS_TABLE: !ImportValue
            Fn::Sub: "${ProjectName}-${Environment}-ProductsTableArn"
          ENVIRONMENT: !Ref Environment
          LOG_LEVEL: !If [IsProd, INFO, DEBUG]
      Timeout: 30
      MemorySize: 256
      ReservedConcurrentExecutions: !If [IsProd, 100, 10]
      Architectures:
        - arm64  # Graviton2
      TracingConfig:
        Mode: Active
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-products-get-function"
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  CheckoutFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-checkout-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt CheckoutLambdaRole.Arn
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: !Sub "${LambdaCodeKey}/checkout.zip"
      Environment:
        Variables:
          CARTS_TABLE: !ImportValue
            Fn::Sub: "${ProjectName}-${Environment}-CartsTableName"
          ORDERS_TABLE: !ImportValue 
            Fn::Sub: "${ProjectName}-${Environment}-OrdersTableName"
          ENVIRONMENT: !Ref Environment
          LOG_LEVEL: !If [IsProd, INFO, DEBUG]
          PAYMENT_PROVIDER: "MOCK"
      Timeout: 60
      MemorySize: 512
      ReservedConcurrentExecutions: !If [IsProd, 50, 5]
      Architectures:
        - arm64  # Graviton2
      TracingConfig:
        Mode: Active
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-checkout-function"
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  ProfileGetFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-profile-get-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt ProfileGetLambdaRole.Arn
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: !Sub "${LambdaCodeKey}/profile-get.zip"
      Environment:
        Variables:
          ORDERS_TABLE: !ImportValue 
            Fn::Sub: "${ProjectName}-${Environment}-OrdersTableName"
          ENVIRONMENT: !Ref Environment
          LOG_LEVEL: !If [IsProd, INFO, DEBUG]
      Timeout: 30
      MemorySize: 256
      ReservedConcurrentExecutions: !If [IsProd, 50, 5]
      Architectures:
        - arm64  # Graviton2
      TracingConfig:
        Mode: Active
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-profile-get-function"
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment

  OrdersGetFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-orders-get-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt OrdersGetLambdaRole.Arn
      Code:
        S3Bucket: !Ref LambdaCodeBucket
        S3Key: !Sub "${LambdaCodeKey}/orders-get.zip"
      Environment:
        Variables:
          ORDERS_TABLE: !ImportValue 
            Fn::Sub: "${ProjectName}-${Environment}-OrdersTableName"
          ENVIRONMENT: !Ref Environment
          LOG_LEVEL: !If [IsProd, INFO, DEBUG]
      Timeout: 30
      MemorySize: 256
      ReservedConcurrentExecutions: !If [IsProd, 50, 5]
      Architectures:
        - arm64  # Graviton2
      TracingConfig:
        Mode: Active
      Tags:
        - Key: Name
          Value: !Sub "${ProjectName}-${Environment}-orders-get-function"
        - Key: Project
          Value: !Ref ProjectName
        - Key: Environment
          Value: !Ref Environment
  
  NotFoundFunction:
    Type: AWS::Lambda::Function
    Properties:
      FunctionName: !Sub "${ProjectName}-${Environment}-not-found-function"
      Runtime: python3.11
      Handler: index.handler
      Role: !GetAtt LambdaExecutionRole.Arn
      Timeout: 3
      MemorySize: 128
      Code:
        ZipFile: |
          def handler(event, context):
              return {
                  "statusCode": 404,
                  "headers": {
                      "Content-Type": "application/json"
                  },
                  "body": '{"message":"Route not found"}'
              }



  # ----------------------
  # Log Groups
  # ----------------------

  CartAddFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${CartAddFunction}"
      RetentionInDays: !If [IsProd, 30, 7]

  CartGetFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${CartGetFunction}"
      RetentionInDays: !If [IsProd, 30, 7]

  CartUpdateFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${CartUpdateFunction}"
      RetentionInDays: !If [IsProd, 30, 7]

  CartRemoveFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${CartRemoveFunction}"
      RetentionInDays: !If [IsProd, 30, 7]

  CartClearFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${CartClearFunction}"
      RetentionInDays: !If [IsProd, 30, 7]

  ProductsGetFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${ProductsGetFunction}"
      RetentionInDays: !If [IsProd, 30, 7]

  CheckoutFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${CheckoutFunction}"
      RetentionInDays: !If [IsProd, 30, 7]

  ProfileGetFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${ProfileGetFunction}"
      RetentionInDays: !If [IsProd, 30, 7]

  OrdersGetFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${OrdersGetFunction}"
      RetentionInDays: !If [IsProd, 30, 7]

  NotFoundFunctionLogGroup:
    Type: AWS::Logs::LogGroup
    DeletionPolicy: !If [IsProd, Retain, Delete]
    UpdateReplacePolicy: !If [IsProd, Retain, Delete]
    Properties:
      LogGroupName: !Sub "/aws/lambda/${NotFoundFunction}"
      RetentionInDays: !If [IsProd, 30, 7]
  


Outputs:

  CartAddFunctionArn:
    Description: CartAdd Lambda function ARN
    Value: !GetAtt CartAddFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartAddFunctionArn"

  CartAddFunctionName:
    Description: CartAdd Lambda function name
    Value: !Ref CartAddFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartAddFunctionName"

  CartGetFunctionArn:
    Description: CartGet Lambda function ARN
    Value: !GetAtt CartGetFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartGetFunctionArn"

  CartGetFunctionName:
    Description: CartGet Lambda function name
    Value: !Ref CartGetFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartGetFunctionName"

  CartUpdateFunctionArn:
    Description: CartUpdate Lambda function ARN
    Value: !GetAtt CartUpdateFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartUpdateFunctionArn"

  CartUpdateFunctionName:
    Description: CartUpdate Lambda function name
    Value: !Ref CartUpdateFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartUpdateFunctionName"

  CartRemoveFunctionArn:
    Description: CartRemove Lambda function ARN
    Value: !GetAtt CartRemoveFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartRemoveFunctionArn"

  CartRemoveFunctionName:
    Description: CartRemove Lambda function name
    Value: !Ref CartRemoveFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartRemoveFunctionName"

  CartClearFunctionArn:
    Description: CartClear Lambda function ARN
    Value: !GetAtt CartClearFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartClearFunctionArn"

  CartClearFunctionName:
    Description: CartClear Lambda function name
    Value: !Ref CartClearFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CartClearFunctionName"

  ProductsGetFunctionArn:
    Description: ProductsGet Lambda function ARN
    Value: !GetAtt ProductsGetFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-ProductsGetFunctionArn"

  ProductsGetFunctionName:
    Description: ProductsGet Lambda function name
    Value: !Ref ProductsGetFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-ProductsGetFunctionName"

  CheckoutFunctionArn:
    Description: Checkout Lambda function ARN
    Value: !GetAtt CheckoutFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CheckoutFunctionArn"

  CheckoutFunctionName:
    Description: Checkout Lambda function name
    Value: !Ref CheckoutFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-CheckoutFunctionName"

  ProfileGetFunctionArn:
    Description: ProfileGet Lambda function ARN
    Value: !GetAtt ProfileGetFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-ProfileGetFunctionArn"

  ProfileGetFunctionName:
    Description: ProfileGet Lambda function name
    Value: !Ref ProfileGetFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-ProfileGetFunctionName"

  OrdersGetFunctionArn:
    Description: OrdersGet Lambda function ARN
    Value: !GetAtt OrdersGetFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-OrdersGetFunctionArn"

  OrdersGetFunctionName:
    Description: OrdersGet Lambda function name
    Value: !Ref OrdersGetFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-OrdersGetFunctionName"

  NotFoundFunctionArn:
    Description: NotFound Lambda function ARN
    Value: !GetAtt NotFoundFunction.Arn
    Export:
      Name: !Sub "${ProjectName}-${Environment}-NotFoundFunctionArn"

  NotFoundFunctionName:
    Description: NotFound Lambda function name
    Value: !Ref NotFoundFunction
    Export:
      Name: !Sub "${ProjectName}-${Environment}-NotFoundFunctionName"
